<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<script type="text/javascript" src="js/app/models/Negociacao.js"></script>
	<script type="text/javascript">
		
		var connection;

		var openRequest = window.indexedDB.open('aluraframe',3); 

		openRequest.onupgradeneeded = e =>{
			console.log('Cria ou altera um banco já existente');

			let minhaConnection = e.target.result;

			//Verifica se ja tem um objectStore se não tiver delete
			if (minhaConnection.objectStoreNames.contains('negociacoes')) {
				minhaConnection.deleteObjectStore('negociacoes');
			}

			minhaConnection.createObjectStore('negociacoes',{autoIncrement: true});
		}

		openRequest.onsuccess = e =>{
			console.log('Conexão obtida com sucesso');

			//Resultado obtido da conexao
			connection = e.target.result;
		}

		openRequest.onerror = e =>{
			console.log(e.target.error);
		}

		//Funcao que adiciona no createObjetcStore('negociacoes')
		const adiciona = () =>{

			//pega uma transação passando como parametro qual é o objectStore e o tipo dele que no caso é leitura e escrita
			let transaction = connection.transaction(['negociacoes'],'readwrite');

			//e a partir da transação vc cria um store pra ter acesso 
			let store = transaction.objectStore('negociacoes');

			//adicionando a negociacao no store
			let negociacao = new Negociacao(new Date(),1,200);
			let request = store.add(negociacao);


			//verifica se a inserção deu sucesso ou erro
			request.onsuccess = e =>{
				console.log('Negociacao incluida com sucesso');
			};

			request.onerror = e =>{
				console.log('Não foi possivel incluir a negociacao');
			}
		}
	</script>
</body>
</html>